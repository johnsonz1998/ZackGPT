<div class="settings-container">
  <div class="settings-header">
    <h1>‚öôÔ∏è ZackGPT Settings</h1>
    <p>Configure your AI assistant's behavior and capabilities</p>
  </div>

  <div class="loading-spinner" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading configuration...</p>
  </div>

  <form *ngIf="!loading" class="settings-form">
    <!-- Core AI Settings -->
    <div class="settings-section">
      <h2>ü§ñ Core AI Settings</h2>
      
      <div class="form-group">
        <label for="model_name">Model</label>
        <select id="model_name" [(ngModel)]="config.model_name" (change)="onConfigChange()" name="model_name">
          <option *ngFor="let model of modelOptions" [value]="model">{{ model }}</option>
        </select>
        <small>Choose the AI model for responses</small>
      </div>

      <div class="form-group">
        <label for="max_tokens">Max Tokens</label>
        <input 
          type="number" 
          id="max_tokens" 
          [(ngModel)]="config.max_tokens" 
          (input)="onConfigChange()"
          name="max_tokens"
          min="1" 
          max="8000"
          [class.invalid]="!isValidMaxTokens()">
        <small [class.error]="!isValidMaxTokens()">
          {{ isValidMaxTokens() ? 'Maximum length of AI responses (1-8000)' : 'Must be between 1 and 8000' }}
        </small>
      </div>

      <div class="form-group">
        <label for="temperature">Temperature</label>
        <input 
          type="number" 
          id="temperature" 
          [(ngModel)]="config.temperature" 
          (input)="onConfigChange()"
          name="temperature"
          min="0" 
          max="2" 
          step="0.1"
          [class.invalid]="!isValidTemperature()">
        <small [class.error]="!isValidTemperature()">
          {{ isValidTemperature() ? 'Creativity level: 0 (focused) to 2 (creative)' : 'Must be between 0 and 2' }}
        </small>
      </div>
    </div>

    <!-- Voice Settings -->
    <div class="settings-section">
      <h2>üéôÔ∏è Voice Settings</h2>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="config.voice_enabled" 
            (change)="onConfigChange()"
            name="voice_enabled">
          <span class="checkmark"></span>
          Enable Voice Features
        </label>
        <small>Allow voice input and text-to-speech output</small>
      </div>

      <div class="form-group" *ngIf="config.voice_enabled">
        <label for="voice_model">Speech Recognition Model</label>
        <input 
          type="text" 
          id="voice_model" 
          [(ngModel)]="config.voice_model" 
          (input)="onConfigChange()"
          name="voice_model"
          placeholder="whisper-1">
        <small>OpenAI Whisper model for speech recognition</small>
      </div>

      <div class="form-group" *ngIf="config.voice_enabled">
        <label for="tts_voice">Text-to-Speech Voice</label>
        <select id="tts_voice" [(ngModel)]="config.tts_voice" (change)="onConfigChange()" name="tts_voice">
          <option *ngFor="let voice of ttsVoices" [value]="voice">{{ voice | titlecase }}</option>
        </select>
        <small>Choose the voice for spoken responses</small>
      </div>
    </div>

    <!-- Memory Settings -->
    <div class="settings-section">
      <h2>üß† Memory Settings</h2>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="config.memory_enabled" 
            (change)="onConfigChange()"
            name="memory_enabled">
          <span class="checkmark"></span>
          Enable Memory System
        </label>
        <small>Remember conversations and learn from interactions</small>
      </div>

      <div class="form-group" *ngIf="config.memory_enabled">
        <label for="max_memory_entries">Max Memory Entries</label>
        <input 
          type="number" 
          id="max_memory_entries" 
          [(ngModel)]="config.max_memory_entries" 
          (input)="onConfigChange()"
          name="max_memory_entries"
          min="1" 
          max="10000"
          [class.invalid]="!isValidMemoryEntries()">
        <small [class.error]="!isValidMemoryEntries()">
          {{ isValidMemoryEntries() ? 'Maximum number of stored memory entries (1-10000)' : 'Must be between 1 and 10000' }}
        </small>
      </div>
    </div>

    <!-- Evolution Settings -->
    <div class="settings-section">
      <h2>üß¨ Prompt Evolution Settings</h2>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="config.evolution_enabled" 
            (change)="onConfigChange()"
            name="evolution_enabled">
          <span class="checkmark"></span>
          Enable Prompt Evolution
        </label>
        <small>Allow AI to improve its prompts based on interactions</small>
      </div>

      <div class="form-group" *ngIf="config.evolution_enabled">
        <label for="evolution_frequency">Evolution Frequency</label>
        <input 
          type="number" 
          id="evolution_frequency" 
          [(ngModel)]="config.evolution_frequency" 
          (input)="onConfigChange()"
          name="evolution_frequency"
          min="1" 
          max="100"
          [class.invalid]="!isValidEvolutionFreq()">
        <small [class.error]="!isValidEvolutionFreq()">
          {{ isValidEvolutionFreq() ? 'How often to run evolution (every N interactions, 1-100)' : 'Must be between 1 and 100' }}
        </small>
      </div>
    </div>

    <!-- Web Search Settings -->
    <div class="settings-section">
      <h2>üîç Web Search Settings</h2>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="config.web_search_enabled" 
            (change)="onConfigChange()"
            name="web_search_enabled">
          <span class="checkmark"></span>
          Enable Web Search
        </label>
        <small>Allow AI to search the internet for current information</small>
      </div>

      <div class="form-group" *ngIf="config.web_search_enabled">
        <label for="web_search_max_results">Max Search Results</label>
        <input 
          type="number" 
          id="web_search_max_results" 
          [(ngModel)]="config.web_search_max_results" 
          (input)="onConfigChange()"
          name="web_search_max_results"
          min="1" 
          max="20"
          [class.invalid]="!isValidWebSearchResults()">
        <small [class.error]="!isValidWebSearchResults()">
          {{ isValidWebSearchResults() ? 'Maximum number of search results to use (1-20)' : 'Must be between 1 and 20' }}
        </small>
      </div>

      <div class="form-group" *ngIf="config.web_search_enabled">
        <div class="api-key-status">
          <p><strong>Search Engine Status:</strong></p>
          <div class="key-status">
            <span class="key-name">SerpAPI:</span>
            <span [class]="config.serpapi_key_masked ? 'key-configured' : 'key-missing'">
              {{ config.serpapi_key_masked || 'Not configured' }}
            </span>
          </div>
          <div class="key-status">
            <span class="key-name">Google Custom Search:</span>
            <span [class]="config.google_api_key_masked && config.google_cse_id_masked ? 'key-configured' : 'key-missing'">
              {{ (config.google_api_key_masked && config.google_cse_id_masked) ? 'Configured' : 'Not configured' }}
            </span>
          </div>
          <div class="key-status">
            <span class="key-name">DuckDuckGo Fallback:</span>
            <span class="key-configured">Always available</span>
          </div>
        </div>
      </div>
    </div>

    <!-- API Keys -->
    <div class="settings-section">
      <h2>üîë API Keys</h2>
      <p class="section-description">Enter your API keys below. Leave blank to keep existing values.</p>
      
      <div class="form-group">
        <label for="openai_key">OpenAI API Key</label>
        <input 
          type="password" 
          id="openai_key" 
          [(ngModel)]="apiKeys.openai_api_key"
          (input)="onApiKeyChange()"
          name="openai_key"
          placeholder="sk-... (leave blank to keep current)">
        <small>Required for AI responses. Current: {{ config.openai_api_key_masked || 'Not set' }}</small>
      </div>

      <div class="form-group">
        <label for="elevenlabs_key">ElevenLabs API Key</label>
        <input 
          type="password" 
          id="elevenlabs_key" 
          [(ngModel)]="apiKeys.elevenlabs_api_key"
          (input)="onApiKeyChange()"
          name="elevenlabs_key"
          placeholder="Optional - leave blank to keep current">
        <small>For voice synthesis. Current: {{ config.elevenlabs_api_key_masked || 'Not set' }}</small>
      </div>

      <div class="api-section">
        <h4>üîç Web Search API Keys</h4>
        <p class="section-note">Choose one or more search engines for best results</p>
        
        <div class="form-group">
          <label for="serpapi_key">SerpAPI Key (Recommended)</label>
          <input 
            type="password" 
            id="serpapi_key" 
            [(ngModel)]="apiKeys.serpapi_key"
            (input)="onApiKeyChange()"
            name="serpapi_key"
            placeholder="Free tier: 100 searches/month">
          <small>
            Get free API key at <a href="https://serpapi.com" target="_blank">serpapi.com</a>. 
            Current: {{ config.serpapi_key_masked || 'Not set' }}
          </small>
        </div>

        <div class="form-group">
          <label for="google_api_key">Google API Key</label>
          <input 
            type="password" 
            id="google_api_key" 
            [(ngModel)]="apiKeys.google_api_key"
            (input)="onApiKeyChange()"
            name="google_api_key"
            placeholder="Alternative search option">
          <small>
            Get from <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a>. 
            Current: {{ config.google_api_key_masked || 'Not set' }}
          </small>
        </div>

        <div class="form-group">
          <label for="google_cse_id">Google Custom Search Engine ID</label>
          <input 
            type="text" 
            id="google_cse_id" 
            [(ngModel)]="apiKeys.google_cse_id"
            (input)="onApiKeyChange()"
            name="google_cse_id"
            placeholder="Required with Google API Key">
          <small>
            Create at <a href="https://cse.google.com" target="_blank">cse.google.com</a>. 
            Current: {{ config.google_cse_id_masked || 'Not set' }}
          </small>
        </div>
      </div>
    </div>

    <!-- Debug Settings -->
    <div class="settings-section">
      <h2>üêõ Debug & Logging</h2>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="config.debug_mode" 
            (change)="onConfigChange()"
            name="debug_mode">
          <span class="checkmark"></span>
          Debug Mode
        </label>
        <small>Enable detailed debugging information</small>
      </div>

      <div class="form-group">
        <label for="log_level">Log Level</label>
        <select id="log_level" [(ngModel)]="config.log_level" (change)="onConfigChange()" name="log_level">
          <option *ngFor="let level of logLevels" [value]="level">{{ level }}</option>
        </select>
        <small>Choose logging verbosity level</small>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="settings-actions">
      <div class="action-buttons">
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="saveConfig()" 
          [disabled]="!isDirty || !isFormValid() || saving">
          {{ saving ? 'Saving...' : 'Save Changes' }}
        </button>
        
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="discardChanges()" 
          [disabled]="!isDirty">
          Discard Changes
        </button>
        
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="resetConfig()">
          Reset to Defaults
        </button>
      </div>
      
      <div class="save-status" *ngIf="isDirty">
        <span class="unsaved-indicator">‚óè</span>
        Unsaved changes
      </div>
    </div>
  </form>


</div> 